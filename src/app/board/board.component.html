

<app-modal *ngIf="currentModal=='column'" 
    [type]="'column'" 
    [column]="currentColumn"
    (columnRenamed)="onColumnRenamed($event)">

</app-modal>






<!-- edit task modal -->
<div class="modal fade edit-task-modal" id="editTaskModal" tabindex="-1" role="dialog" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <!-- modal header -->
            <div class="modal-header" *ngIf="currentTask != null">

                <h5 class="modal-title">
                    <span><i class="bi bi-card-text"></i></span>
                    <span style="padding: 5px"></span>
                    <span class="edit-task-title" id="edit-task-title" contenteditable="true">{{currentTask.name}}
                    </span>
                </h5>

                <!-- x button -->
                <button type="button" class="close"
                    (click)="editTask('name'); updateChecklists(currentTask); toggleTaskActions('all')"
                    data-bs-dismiss="modal">
                    <i class="bi bi-x"></i>
                </button>

            </div> <!-- modal header -->

            <!-- modal body container -->
            <div class="container">
                <div class="modal-body">

                    <!-- row -->
                    <div class="row">

                        <!-- left col -->
                        <div class="col-lg-8">

                            <div class="d-flex edit-task-date mb-2"
                                *ngIf="currentTask != null && currentTask.date != undefined">
                                <div class="edit-task-date-title">
                                    <span><i class="edit-task-date-icon bi bi-calendar4"></i></span>
                                    <span> Due Date</span>

                                    <span class="d-inline ml-3" style="font-size:13px">
                                        <span *ngIf="!currentTask.isComplete" (click)="currentTask.completeTask()"><i
                                                class="task-complete-icon bi bi-square"></i></span>
                                        <!-- <span><i class="bi bi-check-square"></i></span> -->
                                        <span *ngIf="currentTask.isComplete" (click)="currentTask.completeTask()"><i
                                                class="task-complete-icon bi bi-check-square-fill"></i></span>
                                        <p id="task-date-str" class="d-inline ml-1 p-1 rounded font-weight-normal"
                                            style="background:#f1f1f1; font-size:13px">
                                            <span>{{ currentTask.getDateString('long') }}
                                                <small class="rounded align-items-start"
                                                    [style.background]="currentTask.getDateStatus().color"
                                                    style="padding: 0.5px 3px; font-size: 9px">{{
                                                    currentTask.getDateStatus().type }}</small>
                                            </span>
                                        </p>
                                    </span>

                                </div>
                            </div>

                            <!-- edit task description -->
                            <!-- style="background:green" -->
                            <div class="edit-task-description">

                                <!-- title -->
                                <div class="edit-task-description-title">
                                    <span><i class="edit-task-description-icon bi bi-justify-left"></i></span>
                                    <span> Description</span>
                                    <span style="padding:5px"></span>
                                    <small class="text-right edit-task-description-clear"
                                        id="edit-task-description-clear" (click)="editTask('clear')">clear</small>
                                </div> <!-- title -->

                                <!-- content text area -->
                                <div class="edit-task-description-content">
                                    <div class="form-group" *ngIf="currentTask != null">

                                        <!-- keyup.Enter="console.log('enter')"
                                                        keyup.Backspace="console.log('backspace')" -->
                                        <textarea class="form-control edit-task-description-input"
                                            id="edit-task-description-input" placeholder="Add a description" rows="3"
                                            (keyup)="editTask('description')"
                                            *ngIf="currentTask.description == '' "></textarea>

                                        <!-- keyup.Enter="console.log('enter')"
                                                        keyup.Backspace="console.log('backspace')" -->
                                        <textarea class="form-control edit-task-description-input"
                                            id="edit-task-description-input" placeholder="Add a description" rows="3"
                                            (keyup)="editTask('description')"
                                            *ngIf="currentTask.description != '' ">{{currentTask.description}}</textarea>

                                    </div>

                                    <div class="text-right">
                                        <button type="button" id="edit-task-description-cancel"
                                            (click)="editTask('cancel')" class="btn btn-light">Cancel</button>
                                        <span>&nbsp;</span>
                                        <button type="button" id="edit-task-description-save" (click)="editTask('save')"
                                            class="btn btn-success disabled edit-task-description-save">Save</button>
                                    </div>
                                </div> <!-- content text area -->

                            </div> <!-- edit-task-description -->

                            <!-- edit task checklist -->
                            <div class="edit-task-checklist" *ngIf="currentTask != null">

                                <div class="pb-3" id="edit-task-checklist-{{currentTask.checklists.indexOf(checklist)}}"
                                    *ngFor="let checklist of currentTask.checklists">
                                    <!-- title -->
                                    <div class="edit-task-checklist-title">
                                        <span><i class="edit-task-checklist-icon bi bi-list-check"></i></span>
                                        <span
                                            id="edit-task-checklist-{{currentTask.checklists.indexOf(checklist)}}-title"
                                            contenteditable="true"> {{checklist.name}}</span>
                                        <span style="padding:5px"></span>
                                        <small class="text-right edit-task-checklist-delete"
                                            id="edit-task-checklist-delete"
                                            (click)="currentTask.deleteChecklist(checklist)">delete</small>
                                    </div> <!-- title -->

                                    <div class="edit-task-checklist-progress">
                                        <div class="progress mb-1" style="height:10px">
                                            <div class="progress-bar"
                                                id="checklist-{{currentTask.checklists.indexOf(checklist)}}-progress"
                                                style="width:0%;"></div>
                                        </div>
                                    </div>

                                    <div class="form-group edit-task-checklist-items m-0"
                                        *ngFor="let item of checklist.items">
                                        <div class="form-check">
                                            <input class="form-check-input checklist-checkbox" type="checkbox" value=""
                                                id="complete-checklist-{{currentTask.checklists.indexOf(checklist)}}-item"
                                                (click)="item.toggleComplete(); updateProgressBar(currentTask, checklist); updateChecklists(currentTask)">
                                            <!-- <span style="display: none" id="checklist-{{currentTask.checklists.indexOf(checklist)}}-item-{{checklist.items.indexOf(item)}}-name">{{item.name}}</span> -->
                                            <p class="d-flex form-check-label checklist-item-name p-0"
                                                contenteditable="true" *ngIf="!item.isComplete"
                                                id="checklist-{{currentTask.checklists.indexOf(checklist)}}-item-{{checklist.items.indexOf(item)}}-name">
                                                {{item.name}}
                                                <span class="d-flex delete-checklist-item" contenteditable="false"
                                                    (click)="checklist.deleteItem(item)"><i
                                                        class="delete-checklist-item-icon bi bi-trash3"></i></span>
                                            </p>
                                            <p class="d-flex form-check-label checklist-item-name"
                                                contenteditable="true" *ngIf="item.isComplete"
                                                id="checklist-{{currentTask.checklists.indexOf(checklist)}}-item-{{checklist.items.indexOf(item)}}-name">
                                                <s>{{item.name}}</s>
                                                <span class="d-flex delete-checklist-item" contenteditable="false"
                                                    (click)="checklist.deleteItem(item)"><i
                                                        class="delete-checklist-item-icon bi bi-trash3"></i></span>
                                            </p>
                                        </div>

                                    </div>

                                    <div class="form-group edit-task-checklist-new mt-2" id="edit-task-checklist-new">
                                        <input class="form-control form-control-sm mb-1 checklist-item-input"
                                            id="checklist-{{currentTask.checklists.indexOf(checklist)}}-item-input"
                                            placeholder="New Item"
                                            (keyup.Enter)="addChecklistItem(currentTask, checklist); updateProgressBar(currentTask, checklist)">
                                        <button type="button" id="checklist-item-save"
                                            class="btn btn-sm btn-success checklist-item-save"
                                            (click)="addChecklistItem(currentTask, checklist); updateProgressBar(currentTask, checklist)">Add</button>
                                    </div>
                                </div>


                            </div>

                            <!-- edit task activity -->
                            <!-- <div class="edit-task-activity" style="background:teal">
                                            
                                            title
                                            <div class="edit-task-activity-title">
                                                <span><i class="edit-task-activity-icon bi bi-card-checklist"></i></span>
                                                <span> Activity</span>
                                            </div> title

                                            input
                                            <div class="form-group">
                                                <input class="form-control" placeholder="Write a comment">
                                                <button type="button" class="btn btn-success">Save</button>
                                            </div> input
                                            
                                        </div> edit task activity -->

                        </div> <!-- left col -->

                        <!-- right col-->
                        <!-- style="background:red" -->
                        <div class="col-lg-4">
                            <small>Add to Task</small>
                            <!-- accordian -->
                            <div id="accordian">

                                <!-- label -->
                                <div class="list-group border-0 rounded-0 text-sm-start"
                                    (click)="toggleTaskActions('label')">
                                    <a class="list-group-item" data-bs-toggle="collapse"
                                        data-bs-target="#label-assignment">Labels</a>
                                    <div class="collapse" id="label-assignment">
                                        <div class="card card-body label-assignment">
                                            <form class="form-inline" onsubmit="return false">
                                                <div class="form-group" *ngIf="currentTask != null">

                                                    <!-- <div class="form-check"> -->
                                                    <!-- <input class="form-check-input" type="checkbox" value="" id="defaultCheck1"> -->
                                                    <input type="text" class="form-control form-control-sm"
                                                        id="label-input" placeholder="Add Label"
                                                        (keyup.Enter)="addLabel(currentTask)">
                                                    <span style="padding:5px"></span>
                                                    <span (click)="addLabel(currentTask)"><i
                                                            class="add-label-icon bi bi-check2-circle"></i></span>
                                                    <!-- <small><a href='#'>change color</a></small> -->
                                                    <!-- </div> -->

                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div> <!-- label -->

                                <!-- checklist -->
                                <div class="list-group border-0 rounded-0 text-sm-start"
                                    (click)="toggleTaskActions('checklist')">
                                    <a class="list-group-item" data-bs-toggle="collapse"
                                        data-bs-target="#checklist-assignment">Checklist</a>
                                    <div class="collapse" id="checklist-assignment">
                                        <div class="card card-body checklist-assignment">
                                            <small>Title</small>
                                            <form class="form-inline" onsubmit="return false">
                                                <div class="form-group" *ngIf="currentTask != null">

                                                    <!-- <div class="form-check"> -->
                                                    <!-- <input class="form-check-input" type="checkbox" value="" id="defaultCheck1"> -->

                                                    <input type="text" class="form-control form-control-sm"
                                                        id="checklist-title-input" placeholder="Checklist"
                                                        (keyup.Enter)="addChecklist(currentTask)">
                                                    <span style="padding:5px"></span>
                                                    <span (click)="addChecklist(currentTask)"><i
                                                            class="add-checklist-icon bi bi-check2-circle"></i></span>
                                                    <!-- <small><a href='#'>change color</a></small> -->
                                                    <!-- </div> -->

                                                </div>
                                            </form>

                                        </div>
                                    </div>
                                </div> <!-- checklist -->

                                <!-- date -->
                                <div class="list-group border-0 rounded-0 text-sm-start" *ngIf="currentTask != null"
                                    (click)="toggleTaskActions('date')">
                                    <a class="list-group-item" data-bs-toggle="collapse"
                                        data-bs-target="#date-assignment" (click)="setDateInput(currentTask)">Date</a>
                                    <div class="collapse" id="date-assignment">
                                        <div class="card card-body border date-assignment">

                                            <small>Due Date</small>
                                            <form onsubmit="return false">
                                                <div class="form-row">
                                                    <div class="form-group col-12">
                                                        <input class="mt-2 mb-2 form-control form-control-sm"
                                                            type="date" id='task-date'>
                                                        <input class="mt-2 form-control form-control-sm" type="time"
                                                            id='task-time'>
                                                    </div>
                                                    <div class="form-group col-auto">
                                                        <button class="btn btn-sm btn-success" id="task-date-save"
                                                            (click)="addTaskDate(currentTask)">Save</button>
                                                        <span style="padding: 5px"></span>
                                                        <button class="btn btn-sm btn-light" id="task-date-remove"
                                                            (click)="removeTaskDate(currentTask)">Remove</button>
                                                    </div>
                                                </div>
                                            </form>

                                        </div>
                                    </div>
                                </div> <!-- date -->


                            </div> <!-- task action accordian -->

                        </div> <!-- right col -->

                    </div> <!-- row -->

                </div> <!-- modal body -->
            </div> <!-- modal body container -->

            <!-- modal footer -->
            <div class="modal-footer container justify-content-start" *ngIf="currentTask != null">
                <span class="badge badge-pill badge-secondary label" *ngFor="let label of currentTask.labels">
                    {{label.name}}
                    <span class="delete-label-icon" id="delete-label" (click)="currentTask.deleteLabel(label)"><i
                            class="bi bi-x"></i></span>
                </span>
            </div>


        </div> <!-- modal content -->
    </div> <!--modal dialog -->
</div> <!-- edit task modal -->



<!-- board-columns -->
<div class="board-columns" *ngIf="board != null">

    <div class="board-column" *ngFor="let column of board.columns">

        <!-- column title -->
        <div class="container-fluid">
            <div class="row">

                <!-- column name -->
                <div class="col column-title" id="column-title">
                    {{column.name}}
                </div> <!-- column name -->
                <!-- column actions -->
                <div class="col-auto">

                    <div class="column-actions d-flex justify-content-center" data-bs-toggle="dropdown"
                        (click)="setCurrentColumn(column)">
                        <i class="bi bi-three-dots"></i>
                    </div> <!-- ellipses icon -->

                    <!-- column actions dropdown -->
                    <div class="dropdown-menu">
                        <h6 class="dropdown-header">List Actions</h6>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item column-action-item" (click)="column.addTask()">
                            Add Task
                        </a>
                        <!-- (click)="renameColumn(currentBoard, column)"
                                                                data-toggle="modal"
                                                                data-target="#renameColumnModal" -->
                        
                        <!--  data-bs-toggle="modal"
                            data-bs-target="#renameColumnModal" -->
                        <a class="dropdown-item column-action-item" (click)="setCurrentModal('column')">
                            Rename
                        </a>
                        <!-- <a class="dropdown-item" href="#">Something else here</a> -->
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item column-action-item" (click)="board.deleteColumn(column)">
                            Delete List
                        </a>
                    </div> <!-- column actions dropdown -->

                </div> <!-- column actions -->

            </div> <!-- row -->
        </div> <!-- column title -->

        <!-- tasks container -->
        <div class="tasks-container">


            <div class="task" (click)="setCurrentTask(task);" data-bs-toggle="modal" data-bs-target="#editTaskModal"
                *ngFor="let task of column.tasks">

                <span class="task-name">

                    {{ task.name }}

                    <div class="d-flex justify-content-start align-items-center">
                        <div *ngIf="task.hasDate()" [style.background]="task.getDateStatus().color"
                            class=" d-flex mr-2 pl-1 pr-1 rounded task-date-container align-items-center"
                            (mouseover)="taskDateIconToggle(task, 'mouseover')"
                            (mouseout)="taskDateIconToggle(task, 'mouseout')"
                            (click)="task.completeTask(); taskDateIconToggle(task, 'mouseover')">
                            <span style="display:none" id="task-date-square"><i
                                    class="d-flex task-date-icon bi bi-square"></i></span>
                            <span style="display:none" id="task-date-check"><i
                                    class="d-flex task-date-icon bi bi-check-square"></i></span>
                            <span id="task-date-clock"><i class="d-flex task-date-icon bi bi-clock"></i></span>
                            <span class="task-date-short ml-1">{{task.getDateString('short')}}</span>
                        </div>
                        <div *ngIf="task.hasDescription()" class="mr-2 pl-1 pr-1">
                            <small><i class="bi bi-justify-left"></i></small>
                        </div>
                        <!-- <span style="padding: 4px" *ngIf="task.hasDescription() && task.checklists.length > 0"></span> -->

                        <div *ngIf="task.checklists.length > 0" class="mr-2 pl-1 pr-1 rounded d-flex align-items-center"
                            [style.background]="task.getChecklistStatus().isCompleteColor">
                            <span><i class="d-flex task-checklist-icon bi bi-check2-square"></i></span>
                            <span class="ml-1 d-flex task-checklist-text">
                                {{task.getChecklistStatus().complete}}/{{task.getChecklistStatus().total}}</span>
                        </div>

                    </div>

                </span>

                <span><i class="delete-task-icon bi bi-trash3" (click)="column.deleteTask(task)"></i></span>


            </div>

            <div class="task-creator" (click)="column.addTask()">
                Add Task
                <span class="add-task-icon"><i class="bi bi-plus"></i></span>
            </div>

        </div> <!-- tasks container -->

    </div> <!-- board column -->

    <div class="d-flex board-column add-new-list pb-5" (click)="board.addColumn()">
        <p>Add New List
            <span class="add-task-icon"><i class="bi bi-plus"></i></span>
        </p>
    </div>

</div> <!-- board columns -->